================================================================================
                           RESUMO DO SISTEMA DELIVERY TRACK
================================================================================

ğŸ“‹ VISÃƒO GERAL
==============
O Delivery Track Ã© um sistema completo de rastreamento de entregas em tempo real
que permite aos clientes acompanhar suas entregas atravÃ©s de um mapa interativo,
com atualizaÃ§Ãµes em tempo real da posiÃ§Ã£o do entregador.

ğŸ—ï¸ ARQUITETURA DO SISTEMA
=========================

COMPONENTES PRINCIPAIS:
â”œâ”€â”€ Frontend (Next.js + React + TypeScript)
â”‚   â”œâ”€â”€ Interface web responsiva
â”‚   â”œâ”€â”€ Mapa interativo com Leaflet
â”‚   â”œâ”€â”€ WebSocket para atualizaÃ§Ãµes em tempo real
â”‚   â””â”€â”€ AutenticaÃ§Ã£o JWT
â”‚
â”œâ”€â”€ Backend (Fastify + Prisma + TypeScript)
â”‚   â”œâ”€â”€ API REST para gerenciamento de entregas
â”‚   â”œâ”€â”€ AutenticaÃ§Ã£o JWT
â”‚   â”œâ”€â”€ WebSocket para broadcast de localizaÃ§Ãµes
â”‚   â”œâ”€â”€ IntegraÃ§Ã£o com Kafka (opcional)
â”‚   â””â”€â”€ Banco SQLite com Prisma ORM
â”‚
â”œâ”€â”€ Kafka (Sistema de Filas)
â”‚   â”œâ”€â”€ Zookeeper para coordenaÃ§Ã£o
â”‚   â”œâ”€â”€ Eventos de entrega criada/atribuÃ­da
â”‚   â”œâ”€â”€ AtualizaÃ§Ãµes de status
â”‚   â””â”€â”€ Sistema de filas para automaÃ§Ã£o
â”‚
â””â”€â”€ Simulador Python
    â”œâ”€â”€ SimulaÃ§Ã£o de entregadores
    â”œâ”€â”€ Envio de localizaÃ§Ãµes via API
    â”œâ”€â”€ MÃºltiplos entregadores simultÃ¢neos
    â””â”€â”€ Trajetos prÃ©-definidos

ğŸ”„ FLUXO DE DADOS
=================

1. AUTENTICAÃ‡ÃƒO:
   Cliente/Entregador â†’ Login â†’ JWT Token â†’ Acesso ao sistema

2. CRIAÃ‡ÃƒO DE ENTREGA:
   Cliente â†’ API POST /deliveries â†’ Banco de dados â†’ Evento Kafka

3. ATRIBUIÃ‡ÃƒO DE ENTREGADOR:
   Sistema â†’ Kafka â†’ Processamento automÃ¡tico â†’ AtribuiÃ§Ã£o

4. RASTREAMENTO EM TEMPO REAL:
   Entregador â†’ API POST /locations â†’ Banco â†’ WebSocket â†’ Frontend â†’ Mapa

5. VISUALIZAÃ‡ÃƒO:
   Frontend â†’ WebSocket â†’ Recebe localizaÃ§Ãµes â†’ Atualiza mapa â†’ Desenha rota

ğŸ—„ï¸ BANCO DE DADOS (SQLite + Prisma)
===================================

TABELAS:
â”œâ”€â”€ users (UsuÃ¡rios: clientes, entregadores, admins)
â”œâ”€â”€ deliveries (Entregas com status e coordenadas)
â””â”€â”€ locations (HistÃ³rico de localizaÃ§Ãµes por entrega)

RELACIONAMENTOS:
â”œâ”€â”€ User (1) â†’ (N) Delivery (como cliente)
â”œâ”€â”€ User (1) â†’ (N) Delivery (como entregador)
â””â”€â”€ Delivery (1) â†’ (N) Location (histÃ³rico de posiÃ§Ãµes)

ğŸ”§ TECNOLOGIAS UTILIZADAS
=========================

FRONTEND:
â”œâ”€â”€ Next.js 14 (App Router)
â”œâ”€â”€ React 18
â”œâ”€â”€ TypeScript
â”œâ”€â”€ Tailwind CSS
â”œâ”€â”€ Shadcn/ui (componentes)
â”œâ”€â”€ Leaflet (mapas)
â””â”€â”€ WebSocket API

BACKEND:
â”œâ”€â”€ Fastify (servidor web)
â”œâ”€â”€ Prisma (ORM)
â”œâ”€â”€ SQLite (banco)
â”œâ”€â”€ JWT (autenticaÃ§Ã£o)
â”œâ”€â”€ WebSocket (tempo real)
â”œâ”€â”€ KafkaJS (filas)
â””â”€â”€ Zod (validaÃ§Ã£o)

INFRAESTRUTURA:
â”œâ”€â”€ Docker & Docker Compose
â”œâ”€â”€ Apache Kafka
â”œâ”€â”€ Zookeeper
â””â”€â”€ Python (simulador)

ğŸš€ COMO EXECUTAR O SISTEMA
==========================

OPÃ‡ÃƒO 1 - DOCKER COMPOSE (RECOMENDADO):
```bash
cd infra
docker-compose up --build
```

OPÃ‡ÃƒO 2 - EXECUÃ‡ÃƒO MANUAL:
```bash
# Backend
cd backend
npm install
npm run dev

# Frontend
cd frontend
npm install
npm run dev

# Kafka (Docker)
docker run -d --name zookeeper -p 2181:2181 zookeeper:3.4.9
docker run -d --name kafka -p 9092:9092 --env KAFKA_ZOOKEEPER_CONNECT=host.docker.internal:2181 --env KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://localhost:9092 --env KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR=1 wurstmeister/kafka:2.12-2.2.1

# Simulador
pip install requests
python simulador_entregador.py
```

ğŸŒ ACESSOS DO SISTEMA
=====================

- Frontend: http://localhost:3000
- Backend API: http://localhost:3001
- Kafka UI: http://localhost:8080
- Prisma Studio: npx prisma studio

ğŸ‘¥ USUÃRIOS PADRÃƒO
==================

CLIENTES:
â”œâ”€â”€ cliente@exemplo.com / 123456
â””â”€â”€ (pode criar novos via registro)

ENTREGADORES:
â”œâ”€â”€ burns@email.com / 123456
â”œâ”€â”€ homer@email.com / 123456
â””â”€â”€ marge@email.com / 123456

ADMIN:
â””â”€â”€ admin@exemplo.com / 123456

ğŸ§ª COMO TESTAR
==============

1. LOGIN E NAVEGAÃ‡ÃƒO:
   - Acesse http://localhost:3000
   - FaÃ§a login como cliente
   - Visualize lista de entregas

2. RASTREAMENTO EM TEMPO REAL:
   - Abra uma entrega especÃ­fica
   - Execute o simulador Python
   - Observe o mapa sendo atualizado

3. TESTES DE CONCORRÃŠNCIA:
   - Execute mÃºltiplos simuladores
   - Teste diferentes entregas simultaneamente

4. TESTES DE SEGURANÃ‡A:
   - Tente acessar entregas de outros usuÃ¡rios
   - Teste login com credenciais invÃ¡lidas

ğŸ“¡ WEBSOCKET E TEMPO REAL
=========================

ENDPOINT: ws://localhost:3001/api/locations/ws/{deliveryId}

FUNCIONAMENTO:
â”œâ”€â”€ Cliente conecta ao WebSocket
â”œâ”€â”€ Backend salva conexÃ£o por entrega
â”œâ”€â”€ Entregador envia localizaÃ§Ã£o via API
â”œâ”€â”€ Backend faz broadcast via WebSocket
â””â”€â”€ Frontend atualiza mapa em tempo real

ğŸ“Š KAFKA - SISTEMA DE FILAS
===========================

TÃ“PICOS:
â”œâ”€â”€ delivery.created (nova entrega)
â”œâ”€â”€ delivery.assigned (entrega atribuÃ­da)
â”œâ”€â”€ delivery.status.updated (status alterado)
â”œâ”€â”€ location.updated (nova localizaÃ§Ã£o)
â”œâ”€â”€ courier.available (entregador disponÃ­vel)
â””â”€â”€ courier.busy (entregador ocupado)

FUNCIONALIDADES:
â”œâ”€â”€ AtribuiÃ§Ã£o automÃ¡tica de entregas
â”œâ”€â”€ Processamento de eventos
â”œâ”€â”€ IntegraÃ§Ã£o futura com sistemas externos
â””â”€â”€ Monitoramento de status

ğŸ”§ CONFIGURAÃ‡Ã•ES IMPORTANTES
============================

VARIÃVEIS DE AMBIENTE (.env):
```
DATABASE_URL=file:/app/prisma/dev.db
ENABLE_KAFKA=true
KAFKA_BROKERS=localhost:9092
```

DOCKER COMPOSE:
- Backend: porta 3001
- Frontend: porta 3000
- Kafka: porta 9092
- Zookeeper: porta 2181
- Kafka UI: porta 8080

ğŸ“ ESTRUTURA DE ARQUIVOS
========================

projeto/
â”œâ”€â”€ backend/           # API Fastify + Prisma
â”œâ”€â”€ frontend/          # Next.js + React
â”œâ”€â”€ infra/            # Docker Compose
â”œâ”€â”€ docs/             # DocumentaÃ§Ã£o
â”œâ”€â”€ simulador_entregador.py
â””â”€â”€ criar_entrega_teste.py

ğŸ” MONITORAMENTO E LOGS
=======================

BACKEND:
- Logs de autenticaÃ§Ã£o
- Logs de WebSocket
- Logs de Kafka (se habilitado)
- Logs de erro e debug

FRONTEND:
- Console do navegador
- Logs de WebSocket
- Logs de erro de API

KAFKA:
- Kafka UI para monitoramento
- Logs de produÃ§Ã£o/consumo

ğŸš¨ TROUBLESHOOTING
==================

PROBLEMAS COMUNS:
â”œâ”€â”€ Porta jÃ¡ em uso â†’ Mude porta ou pare processo
â”œâ”€â”€ Kafka nÃ£o conecta â†’ Verifique variÃ¡veis de ambiente
â”œâ”€â”€ WebSocket nÃ£o funciona â†’ Verifique CORS e URLs
â”œâ”€â”€ Frontend nÃ£o carrega â†’ Verifique build e dependÃªncias
â””â”€â”€ Banco nÃ£o inicializa â†’ Execute migrations do Prisma

SOLUÃ‡Ã•ES:
â”œâ”€â”€ docker-compose down && docker-compose up --build
â”œâ”€â”€ npm install (frontend e backend)
â”œâ”€â”€ npx prisma generate && npx prisma db push
â””â”€â”€ Verificar logs dos containers

ğŸ“ˆ PRÃ“XIMOS PASSOS
==================

MELHORIAS SUGERIDAS:
â”œâ”€â”€ Interface para criaÃ§Ã£o de entregas
â”œâ”€â”€ Dashboard administrativo
â”œâ”€â”€ NotificaÃ§Ãµes push
â”œâ”€â”€ IntegraÃ§Ã£o com APIs de geocoding
â”œâ”€â”€ Sistema de avaliaÃ§Ã£o
â”œâ”€â”€ RelatÃ³rios e analytics
â””â”€â”€ Deploy em produÃ§Ã£o

================================================================================
                           FIM DO RESUMO
================================================================================ 